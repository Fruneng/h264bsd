function H264bsdCanvas(e,t){this.canvasElement=e,t&&t.forceNoGL||this.initContextGL(),this.contextGL&&(this.initProgram(t),this.initBuffers(),this.initTextures())}H264bsdCanvas.prototype.isWebGL=function(){return this.contextGL},H264bsdCanvas.prototype.initContextGL=function(){for(var e=this.canvasElement,t=null,r=["webgl","experimental-webgl","moz-webgl","webkit-3d"],a=0;!t&&a<r.length;){var o=r[a];try{t=e.getContext(o)}catch(e){t=null}t&&"function"==typeof t.getParameter||(t=null),++a}this.contextGL=t},H264bsdCanvas.prototype.initProgram=function(e){var t=this.contextGL,r=["attribute vec4 vertexPos;","attribute vec4 texturePos;","varying vec2 textureCoord;","void main()","{","gl_Position = vertexPos;","textureCoord = texturePos.xy;","}"].join("\n"),a=["mat4 (","1,  0,       1.5748, -0.7874,","1, -0.1873, -0.4681,  0.3277,","1,  1.8566,  0,      -0.9278,","0,  0,       0,       1",")"].join(" "),o=["mat4 (","1.1643828125,  0,              1.59602734375, -0.87078515625,","1.1643828125, -0.39176171875, -0.81296875,     0.52959375,","1.1643828125,  2.017234375,    0,             -1.081390625,","0,             0,              0,              1",")"].join(" ");e.hasOwnProperty("fullRangeColor")&&e.fullRangeColor&&(console.log("Using full range color conversion"),o=a);var i=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","const mat4 YUV2RGB = "+o+";","void main(void) {","highp float y = texture2D(ySampler,  textureCoord).r;","highp float u = texture2D(uSampler,  textureCoord).r;","highp float v = texture2D(vSampler,  textureCoord).r;","gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n"),n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,r),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)||console.log("Vertex shader failed to compile: "+t.getShaderInfoLog(n));var u=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(u,i),t.compileShader(u),t.getShaderParameter(u,t.COMPILE_STATUS)||console.log("Fragment shader failed to compile: "+t.getShaderInfoLog(u));var s=t.createProgram();t.attachShader(s,n),t.attachShader(s,u),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||console.log("Program failed to compile: "+t.getProgramInfoLog(s)),t.useProgram(s),this.shaderProgram=s},H264bsdCanvas.prototype.initBuffers=function(){var e=this.contextGL,t=this.shaderProgram,r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var a=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0);var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var i=e.getAttribLocation(t,"texturePos");e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),this.texturePosBuffer=o},H264bsdCanvas.prototype.initTextures=function(){var e=this.contextGL,t=this.shaderProgram,r=this.initTexture(),a=e.getUniformLocation(t,"ySampler");e.uniform1i(a,0),this.yTextureRef=r;var o=this.initTexture(),i=e.getUniformLocation(t,"uSampler");e.uniform1i(i,1),this.uTextureRef=o;var n=this.initTexture(),u=e.getUniformLocation(t,"vSampler");e.uniform1i(u,2),this.vTextureRef=n},H264bsdCanvas.prototype.initTexture=function(){var e=this.contextGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t},H264bsdCanvas.prototype.drawNextOutputPicture=function(e,t,r,a){this.contextGL?this.drawNextOuptutPictureGL(e,t,r,a):this.drawNextOuptutPictureRGBA(e,t,r,a)},H264bsdCanvas.prototype.drawNextOuptutPictureGL=function(e,t,r,a){var o=this.contextGL,i=this.texturePosBuffer,n=this.yTextureRef,u=this.uTextureRef,s=this.vTextureRef;if(null===r)o.viewport(0,0,e,t);else{o.viewport(0,0,r.width,r.height);var T=r.top/t,E=r.left/e,h=r.height/t,l=r.width/e,x=new Float32Array([l,T,E,T,l,h,E,h]);o.bindBuffer(o.ARRAY_BUFFER,i),o.bufferData(o.ARRAY_BUFFER,x,o.DYNAMIC_DRAW)}var f=a,c=e*t,R=f.subarray(0,c);o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,n),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,e,t,0,o.LUMINANCE,o.UNSIGNED_BYTE,R);var m=e/2*t/2,v=f.subarray(c,c+m);o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,u),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,e/2,t/2,0,o.LUMINANCE,o.UNSIGNED_BYTE,v);var g=m,d=f.subarray(c+m,c+m+g);o.activeTexture(o.TEXTURE2),o.bindTexture(o.TEXTURE_2D,s),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,e/2,t/2,0,o.LUMINANCE,o.UNSIGNED_BYTE,d),o.drawArrays(o.TRIANGLE_STRIP,0,4)},H264bsdCanvas.prototype.drawNextOuptutPictureRGBA=function(e,t,r,a){var o=a,i=this.canvasElement.getContext("2d"),n=i.getImageData(0,0,e,t);n.data.set(o),i.putImageData(n,0,0)};