function H264bsdCanvas(t,e){this.canvasElement=t,e&&e.forceNoGL||this.initContextGL(),this.contextGL&&(this.initProgram(e),this.initBuffers(),this.initTextures())}H264bsdCanvas.prototype.isWebGL=function(){return this.contextGL},H264bsdCanvas.prototype.initContextGL=function(){for(var t=this.canvasElement,e=null,r=["webgl","experimental-webgl","moz-webgl","webkit-3d"],a=0;!e&&a<r.length;){var i=r[a];try{e=t.getContext(i)}catch(t){e=null}e&&"function"==typeof e.getParameter||(e=null),++a}this.contextGL=e},H264bsdCanvas.prototype.initProgram=function(t){var e=this.contextGL,r=["attribute vec4 vertexPos;","attribute vec4 texturePos;","varying vec2 textureCoord;","void main()","{","gl_Position = vertexPos;","textureCoord = texturePos.xy;","}"].join("\n"),a=["mat4 (","1.1643828125, 0, 1.59602734375, -.87078515625,","1.1643828125, -.39176171875, -.81296875, .52959375,","1.1643828125, 2.017234375, 0, -1.081390625,","0, 0, 0, 1",")"].join(),i=["mat4 (","1, 0, 1.28033, 1,","1, -.21482, -.38059, 1,","1, 2.12798, 0, 1,","0, 0, 0, 1",")"].join(),t=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","const mat4 YUV2RGB = "+(a=t.hasOwnProperty("fullRange")&&t.fullRange?i:a)+";","void main(void) {","highp float y = texture2D(ySampler,  textureCoord).r;","highp float u = texture2D(uSampler,  textureCoord).r;","highp float v = texture2D(vSampler,  textureCoord).r;","gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n"),i=e.createShader(e.VERTEX_SHADER),a=(e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||console.log("Vertex shader failed to compile: "+e.getShaderInfoLog(i)),e.createShader(e.FRAGMENT_SHADER)),r=(e.shaderSource(a,t),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)||console.log("Fragment shader failed to compile: "+e.getShaderInfoLog(a)),e.createProgram());e.attachShader(r,i),e.attachShader(r,a),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||console.log("Program failed to compile: "+e.getProgramInfoLog(r)),e.useProgram(r),this.shaderProgram=r},H264bsdCanvas.prototype.initBuffers=function(){var t=this.contextGL,e=this.shaderProgram,r=t.createBuffer(),r=(t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),t.STATIC_DRAW),t.getAttribLocation(e,"vertexPos")),r=(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,2,t.FLOAT,!1,0,0),t.createBuffer()),e=(t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW),t.getAttribLocation(e,"texturePos"));t.enableVertexAttribArray(e),t.vertexAttribPointer(e,2,t.FLOAT,!1,0,0),this.texturePosBuffer=r},H264bsdCanvas.prototype.initTextures=function(){var t=this.contextGL,e=this.shaderProgram,r=this.initTexture(),a=t.getUniformLocation(e,"ySampler"),a=(t.uniform1i(a,0),this.yTextureRef=r,this.initTexture()),r=t.getUniformLocation(e,"uSampler"),r=(t.uniform1i(r,1),this.uTextureRef=a,this.initTexture()),a=t.getUniformLocation(e,"vSampler");t.uniform1i(a,2),this.vTextureRef=r},H264bsdCanvas.prototype.initTexture=function(){var t=this.contextGL,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null),e},H264bsdCanvas.prototype.drawNextOutputPicture=function(t,e,r,a){this.contextGL?this.drawNextOuptutPictureGL(t,e,r,a):this.drawNextOuptutPictureRGBA(t,e,r,a)},H264bsdCanvas.prototype.drawNextOuptutPictureGL=function(t,e,r,a){var i=this.contextGL,o=this.texturePosBuffer,n=this.yTextureRef,E=this.uTextureRef,h=this.vTextureRef,r=(null===r?i.viewport(0,0,t,e):(i.viewport(0,0,r.width,r.height),T=r.top/e,u=r.left/t,s=r.height/e,r=r.width/t,T=new Float32Array([r,T,u,T,r,s,u,s]),i.bindBuffer(i.ARRAY_BUFFER,o),i.bufferData(i.ARRAY_BUFFER,T,i.DYNAMIC_DRAW)),a),u=t*e,s=r.subarray(0,u),o=(i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,n),i.texImage2D(i.TEXTURE_2D,0,i.LUMINANCE,t,e,0,i.LUMINANCE,i.UNSIGNED_BYTE,s),t/2*e/2),T=r.subarray(u,u+o);i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,E),i.texImage2D(i.TEXTURE_2D,0,i.LUMINANCE,t/2,e/2,0,i.LUMINANCE,i.UNSIGNED_BYTE,T);a=r.subarray(u+o,u+o+o);i.activeTexture(i.TEXTURE2),i.bindTexture(i.TEXTURE_2D,h),i.texImage2D(i.TEXTURE_2D,0,i.LUMINANCE,t/2,e/2,0,i.LUMINANCE,i.UNSIGNED_BYTE,a),i.drawArrays(i.TRIANGLE_STRIP,0,4)},H264bsdCanvas.prototype.drawNextOuptutPictureRGBA=function(t,e,r,a){var i=this.canvasElement.getContext("2d"),t=i.getImageData(0,0,t,e);t.data.set(a),i.putImageData(t,0,0)};